
# AutoRia Used Cars Scraper

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –¥–ª—è –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ–≥–æ —Å–∫—Ä–∞–ø—ñ–Ω–≥—É –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ **AutoRia**  
(—Ä–æ–∑–¥—ñ–ª –±/—É –∞–≤—Ç–æ) –∑ –ø–æ–¥–∞–ª—å—à–∏–º –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º –¥–∞–Ω–∏—Ö —É **PostgreSQL** —Ç–∞
—â–æ–¥–µ–Ω–Ω–∏–º –¥–∞–º–ø–æ–º –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.

---

## üìå –û–ø–∏—Å –∑–∞–¥–∞—á—ñ

–ó–∞—Å—Ç–æ—Å—É–Ω–æ–∫ —â–æ–¥–µ–Ω–Ω–æ:
- –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –≤—Å—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –±/—É –∞–≤—Ç–æ, –ø–æ—á–∏–Ω–∞—é—á–∏ –∑—ñ —Å—Ç–∞—Ä—Ç–æ–≤–æ—ó  
  https://auto.ria.com/uk/car/used/
- –∑–∞—Ö–æ–¥–∏—Ç—å —É –∫–æ–∂–Ω—É –∫–∞—Ä—Ç–∫—É –∞–≤—Ç–æ
- –∑–±–∏—Ä–∞—î –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –ø–æ–ª—è
- –∑–±–µ—Ä—ñ–≥–∞—î –¥–∞–Ω—ñ –≤ PostgreSQL **–±–µ–∑ –¥—É–±–ª—ñ–≤**
- –≤–∏–∫–æ–Ω—É—î —â–æ–¥–µ–Ω–Ω–∏–π –¥–∞–º–ø –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —É –ø–∞–ø–∫—É `dumps`

–ß–∞—Å –∑–∞–ø—É—Å–∫—É —Å–∫—Ä–∞–ø—ñ–Ω–≥—É —Ç–∞ –¥–∞–º–ø—É –Ω–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `.env`.

---

## üß± –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–π

- **Python 3.11**
- **pip** (package manager)
- **httpx** (async HTTP client)
- **BeautifulSoup**
- **SQLAlchemy (async)**
- **PostgreSQL**
- **APScheduler**
- **Docker / docker-compose**
- (–æ–ø—Ü—ñ–π–Ω–æ) **Playwright** –¥–ª—è –¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

```

AutoRia/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ crawler/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scraper.py        # –∑–±—ñ—Ä –ø–æ—Å–∏–ª–∞–Ω—å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parser.py         # –ø–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ä—Ç–∫–∏ –∞–≤—Ç–æ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ phone_playwright.py  # fallback –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω—É
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ **init**.py
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py       # async engine + session
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py         # ORM –º–æ–¥–µ–ª—å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ crud.py           # –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –±–µ–∑ –¥—É–±–ª—ñ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ **init**.py
‚îÇ   ‚îú‚îÄ‚îÄ jobs.py               # –¥–∞–º–ø –±–∞–∑–∏
‚îÇ   ‚îú‚îÄ‚îÄ settings.py           # —á–∏—Ç–∞–Ω–Ω—è .env
‚îÇ   ‚îî‚îÄ‚îÄ **init**.py
‚îÇ
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ docker-entrypoint-initdb.d/
‚îÇ       ‚îî‚îÄ‚îÄ init.sql
‚îÇ
‚îú‚îÄ‚îÄ dumps/                    # —â–æ–¥–µ–Ω–Ω—ñ –¥–∞–º–ø–∏ –ë–î
‚îÇ
‚îú‚îÄ‚îÄ .env                      # –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ run.py                    # entrypoint + scheduler
‚îî‚îÄ‚îÄ README.md

````

---

## üóÑÔ∏è –ü–æ–ª—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

| –ü–æ–ª–µ | –¢–∏–ø |
|----|----|
| url | string |
| title | string |
| price_usd | integer |
| odometer | integer (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 95 —Ç–∏—Å. ‚Üí 95000) |
| username | string |
| phone_number | integer (—Ñ–æ—Ä–º–∞—Ç 38063‚Ä¶‚Ä¶) |
| image_url | string |
| images_count | integer |
| car_number | string |
| car_vin | string |
| datetime_found | datetime |

---

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (.env)

–ü—Ä–∏–∫–ª–∞–¥:

```env
POSTGRES_DB=autoria
POSTGRES_USER=autoria
POSTGRES_PASSWORD=autoria

SCRAPE_TIME=12:00
DUMP_TIME=12:05
TZ=Europe/Kyiv
````

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É

### 1. –ó–±—ñ—Ä–∫–∞ —Ç–∞ –∑–∞–ø—É—Å–∫

```bash
docker compose up --build
```

### 2. –†—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∞–ø—ñ–Ω–≥—É (–¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)

```bash
docker exec -it autoria_app python -c "import asyncio; from run import scrape_job; asyncio.run(scrape_job(limit_pages=1))"
```

---

## ‚è±Ô∏è –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **APScheduler**:

* —â–æ–¥–µ–Ω–Ω–∏–π –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∞–ø—ñ–Ω–≥—É —É `SCRAPE_TIME`
* —â–æ–¥–µ–Ω–Ω–∏–π –¥–∞–º–ø –±–∞–∑–∏ —É `DUMP_TIME`
* —á–∞—Å–æ–≤–∏–π –ø–æ—è—Å –∑–∞–¥–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `TZ`

---

## üìû –ó–±—ñ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤ (–≤–∞–∂–ª–∏–≤–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è)

–ù–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ **AutoRia** –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É:

* –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π –º–∞—Å–∫–æ—é
* –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è **–¥–∏–Ω–∞–º—ñ—á–Ω–æ —á–µ—Ä–µ–∑ JavaScript**
* –∑–∞–ø–∏—Ç –¥–æ `/users/phones/` –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ª–∏—à–µ –ø—ñ—Å–ª—è UI-–≤–∑–∞—î–º–æ–¥—ñ—ó
  (–∫–Ω–æ–ø–∫–∞ *¬´–ü–æ–∫–∞–∑–∞—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω¬ª*)

–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –¥–≤–∞ –ø—ñ–¥—Ö–æ–¥–∏:

1. **HTTP-–∑–∞–ø–∏—Ç —á–µ—Ä–µ–∑ expires/hash**, —è–∫—â–æ —Ç–æ–∫–µ–Ω–∏ –ø—Ä–∏—Å—É—Ç–Ω—ñ –≤ HTML
2. **Fallback —á–µ—Ä–µ–∑ Playwright** (–∫–ª—ñ–∫ + network listener)

‚ö†Ô∏è –ù–∞ –º–æ–º–µ–Ω—Ç —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó AutoRia:

* –Ω–µ –∑–∞–≤–∂–¥–∏ –≤—ñ–¥–¥–∞—î `expires/hash` —É HTML
* —á–∞—Å—Ç–∏–Ω–∞ XHR-–∑–∞–ø–∏—Ç—ñ–≤ –±–ª–æ–∫—É—î—Ç—å—Å—è —É headless-—Ä–µ–∂–∏–º—ñ

–£ —Ç–∞–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö:

* `phone_number` –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —è–∫ `NULL`
* –ø–∞–π–ø–ª–∞–π–Ω –ø—Ä–∞—Ü—é—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ
* –≤—Å—ñ —ñ–Ω—à—ñ –ø–æ–ª—è –∑–±–∏—Ä–∞—é—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ

–¶–µ –æ—á—ñ–∫—É–≤–∞–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ –¥–ª—è production-—Å–∞–π—Ç—É –∑ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–º –∑–∞—Ö–∏—Å—Ç–æ–º.

---

## ‚úÖ –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –≤–∏–º–æ–≥–∞–º –¢–ó

* ‚úî PostgreSQL
* ‚úî –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –¥—É–±–ª—ñ–≤
* ‚úî –©–æ–¥–µ–Ω–Ω–∏–π –¥–∞–º–ø –ë–î
* ‚úî pip
* ‚úî .env
* ‚úî README.md
* ‚úî docker-compose
* ‚úî –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ—Å—Ç—å
* ‚úî –ó–±—ñ—Ä —É—Å—ñ—Ö –ø–æ–ª—ñ–≤ (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –æ–±–º–µ–∂–µ–Ω—å —Å–∞–π—Ç—É)

---

## üìé –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü—Ä–æ—î–∫—Ç –≥–æ—Ç–æ–≤–∏–π –¥–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∞ –∑–∞–ø—É—Å–∫—É –ª–æ–∫–∞–ª—å–Ω–æ –∞–±–æ —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö.
